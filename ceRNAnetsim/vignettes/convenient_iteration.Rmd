---
title: "An Offer: How to Find the Appropriate Iteration for Simulation"
author: "Selcen Ari"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An Offer: How to Find the Appropriate Iteration for Simulation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## ceRNAnetsim

```{r, message=FALSE, warning= FALSE}
#install.packages("devtools")
#devtools::install_github("selcenari/ceRNAnetsim")

library(ceRNAnetsim)
```

```{r, echo=FALSE, message= FALSE, warning=FALSE}
library(rlang)
library(tidyverse)
library(tidygraph)
library(igraph)
library(ggraph)
library(purrr)
library(future)
library(furrr)
library(png)
```


# What is the problem or point?

In the `regulationSimulatoR` package, regulations of miRNA:target pairs are observed via direct or indirect interactions of elements in network. In this approach, change in expression level of single gene or miRNA can affect the whole network like water wave. So, when the change is applied the system, it affects to primary neighborhood firstly, and then the secondary. 

In the simple interaction network like *minsamp*, the water wave-like behavior could be understood, because the neighborhoods of the primary linked elements of trigger element are not interacted to each other. The non-complex interaction can be facilitated to provide the steady-state, after the network is disturbed.

```{r, fig.height=5, fig.width=6, warning=FALSE, message=FALSE, fig.show='hide'}
data("minsamp")

minsamp%>%
   priming_graph(competing_count = Competing_expression, miRNA_count = miRNA_expression)%>%
   update_nodes(once=TRUE)%>%
   update_how("Gene4",2)%>%
  update_nodes()%>%
   simulate_vis(title = "Minsamp: Common element as trigger", 15)

```

![Minsamp common target perturbation](con_iter_chunk3.gif)

For example, in *minsamp* dataset, the steady-state is occured at iteration-14, as seen above. However, when interactions are more complex, the number of iterations required to maintain steady-state may increase. While the iteration-14 is sufficient for *minsamp* dataset, the steady-state could not be ensured at iteration-15 for *midsamp*, as seen following.


```{r, fig.height=5, fig.width=6, warning=FALSE, message=FALSE, fig.show='hide'}
data("midsamp")

midsamp

midsamp%>%
priming_graph(Gene_expression, miRNA_expression)%>%
  update_nodes(once = TRUE)%>%
  update_how("Gene17",2)%>%
  update_nodes()%>%
   simulate_vis(title = "Minsamp: Common element as trigger", 15)
```

![Midsamp Gene17 perturbation with 15 iteration](con_iter_chunk4.gif)

For these reasons, we developed an approach to  find optimal iteration of the given network. `find_iteration()` function analyses the dataset for given iteration number (`.iter` argument) and offers the iteration that has maximum affected nodes' count. The other argument is `limit` that is the minimum amount of change of any node. The `limit` argument takes into account while the amount of affected node is calculated. Note that a slightly difference on the amount of the any elements on the network can be cause the excessive results.

```{r}
find_iteration(midsamp, Gene_expression, miRNA_expression, node_name = "Gene2", .iter= 50, how = 2, limit=0)
```

When `iteration_graph()` function are used with `find_iteration()`, the disturbed elements' count (%) with iteration number can also be viewed in a plot. Optionally, the iteration number (cycle) that is used in `simulate()` function can be selected with help of obtained graph.

```{r, fig.align='center', fig.width=5, fig.height=3, dpi= 120}
iteration_graph(midsamp, competing_count = Gene_expression, miRNA_count = miRNA_expression, node_name = "Gene17", .iter= 50, how = 2, limit=0 )
```

## Let's try offer of `iteration_graph` for Gene17.

As shown the plot in the above, gaining the steady-state is after the iteration-22. If we try to simulate the network with iteration-25, the results are as following:

```{r, fig.height=5, fig.width=6, warning=FALSE, message=FALSE, fig.show='hide'}
midsamp%>%
priming_graph(Gene_expression, miRNA_expression)%>%
  update_nodes(once = TRUE)%>%
  update_how("Gene17",2)%>%
  update_nodes()%>%
   simulate_vis(title = "Minsamp: Common element as trigger", 25)
```

![Midsamp Gene17 perturbation with 25 iteration](con_iter_chunk7.gif)

The workflow that is aforementioned in this vignette should be thought as suggestion. Because the `cycle` is a critical argument that is used with `simulate()` function and affects all results of analysis. In light of this vignette and functions, the approach can be developed according to persent dataset.

